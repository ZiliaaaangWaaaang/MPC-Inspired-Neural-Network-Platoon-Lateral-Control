function [Y,Xf,Af] = nnmove_21(X,~,~)
%NNMOVE_21 neural network simulation function.
%
% Auto-generated by MATLAB, 29-Jun-2024 12:53:41.
% 
% [Y] = nnmove_21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.644786415382709;-2.08798180279202;-0.533403245818273;-1.89546903030855];
x1_step1.gain = [1.42933908693485;0.473316379586819;1.97939958841911;0.499777584457468];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9051923633259755242;2.9320697698048228119;2.4616379186759220765;-1.7498079997857032275;1.9908338853011304792;2.0918143019416466366;-1.1752021505375436217;-0.99025973938490241544;0.35417556441216008212;0.41058985236677503217;0.46325955383082212391;1.1988529043898596971;0.52989566599680781867;-1.0169131561580253553;1.6737612443169735954;1.3609166246565826963;-1.7218774559417107106;-2.5004662595027338234;-2.2732260393781964503;-2.9465044261736497155];
IW1_1 = [0.41950109580709421531 -0.41522601484884419376 -0.64004332762342652785 -3.0146806017625165097;-0.090939947532514747719 0.45987762147565736104 -2.029640464525159782 -1.7393417571879914441;-1.0749717034593861964 2.0102248004271747739 -0.35077987886694073083 1.8366015035998124461;2.133483053632331039 -1.44901219989103347 1.785255661971638208 0.019737284068909139584;-1.686034194325443103 1.3301831711234106681 -0.58939279120305076987 1.7220808428113254518;-1.4492482204957914949 -2.1257668669536657902 0.48127624709397859304 0.72796133182065381195;1.6518329116332077788 0.76695965831743573293 -2.5045304507495274038 0.4596013775162209325;1.6080270304981827412 0.55727910973497540859 -1.5375946104348012788 1.8186451576527338236;0.033249547411387893325 -1.0209874643904304214 2.3742651379958652491 0.68609549507542921809;-0.47394021350305637341 -1.9180585635292148883 0.98063679138125281476 1.6346740332674793983;-0.1763710971710619746 1.9545855346547502673 0.41729542391314461414 -0.012152350317030546911;0.60834141700581967349 1.9879379745329508467 1.7766679324624221614 -0.76967782216749336399;1.5661282993381460127 1.5651178024898091401 -0.77108364565920728406 1.3953066234359594588;-0.34535033774884821289 -1.0349005769548185185 1.7753254466067320827 2.1082617463359487608;1.3939967881043255904 1.0165092046002914827 -2.1646768287908422224 0.67261185734397010982;0.11035054008380425217 -0.67567414645880163881 -1.9594467510709312474 -1.6454735248037086759;-1.8515416648052245296 0.62246255718714349481 1.5076390074893548654 1.7251155136664138023;-0.26959385062891821905 1.3949772876537254174 2.6269014525187679432 -0.4747432812677390146;-0.52027757011613973148 2.2291038063577182093 1.8597236977926949741 -0.23202099130268036276;-1.4767774533047115515 0.1461277266660830354 2.4549621428049239746 0.78007515520414771881];

% Layer 2
b2 = [-1.4362156007692348236;1.3515768090620983166;-0.85927307308030165256;0.71517592947917296708;0.080652140088988938382;-0.20471609424417167022;0.52056919876762597355;-0.89585611362459560691;-1.268104993959392246;1.5656912453770857052];
LW2_1 = [0.26908365075979001624 0.017947066957612788779 -0.050777111854678917691 -0.56372484313451243221 0.16408797659589624551 -0.654794932080127845 -0.55072835749218507218 -0.29416835778813543723 -0.34346088232416166486 0.20548569400847491173 -0.021189157022143023656 -0.72104356121303669891 -0.31739034316150233073 0.0054797136051712887206 -0.076571090453942086684 -0.34204104346920638502 0.32494843243286541945 0.18634671118955947744 -0.70236981423225286481 0.50085849030938689452;-0.43264009491718374845 -0.23597180575165369043 -0.15030257052607287616 0.29959189647054107475 -0.34509566920709033866 -0.054799940270442305812 0.79043471859519331968 -0.54510013549359892515 0.55214683126857888595 0.13891974289226696748 -0.093909056198275317473 -0.41879165958954195359 -0.28323298805390501043 0.41085103252708277122 -0.12344828592230847053 -0.37837530540831609827 0.12688989156790064783 0.092849659985339866308 0.50123446172169394686 -0.25349264702398754956;0.24166654145277155497 0.13016382238743570698 0.68411387496647380058 0.16992621549353742472 -0.56908785818909601861 0.59273929176753592518 -0.78511419516373825989 0.36331617409575150957 0.06726044082940807467 -0.080917283618907057119 -0.99302871142202386867 -0.06465143439626129529 -0.30961328078841204858 -0.30557937072073104723 -0.17572214595941654247 0.23732423549293624188 0.31853223036222028108 -0.60865936297794143162 -0.14931728927865134393 0.14587281019449699349;-0.43052592247366749945 0.52615421254625216463 0.16451226967130305745 -0.82049516349964568551 -0.50495967144193398823 -0.3902527529084332536 -0.22209378412468336328 0.44221462205349959529 0.28689858229815456969 -0.062676155936619112885 0.31809927664767273514 -0.3304977088856518308 -0.43320934526358323424 0.0075911849501232968318 0.26689858917481867895 -0.36911957046880428113 0.42744271333508698785 0.68966913420685571623 0.38203791159113864584 -0.30353976797191983827;-0.50610128105601726034 0.26566790343869600699 -0.12214915033930759392 0.049564383994377132769 0.46564732982722517596 -0.16571323039768609542 -0.38090727979637634126 0.24539987340537097738 0.32298223277755161442 -0.21973244293671306826 0.59226969219664904465 -0.51486188747214334249 0.24460491040045734268 0.46948454230709435464 -0.33666822215612995928 0.3555634445317745751 0.055211435453540999574 0.41224268821534737484 -0.1568751310018777767 0.56418699437234698379;-0.20529177865803655001 0.31624616828942442304 -0.14873353421462309765 0.31552006312060448812 0.34577639691651340659 0.85628114028886326281 -0.30529356257140960462 -0.22822500869936496182 0.32785615268718681925 -0.55945979170035164962 -0.077345208962659242613 -0.01863460585386380805 0.16368225486811704972 -0.52924723478586543912 -0.5244874171403146601 -0.3919387993846703 0.38079486565015219224 -0.35454847104922848633 0.63732121662024088238 0.14047446573732305652;0.050014452747231145924 -0.035483806854061272773 0.11361951959879063034 0.59974490458358920009 0.10854593697001058139 -0.046402434453317167873 -0.45670809478804286208 0.68505377705209313799 0.54606416956767234172 0.053742089310151702763 0.13341739283227241342 0.45058113187592641058 0.21916909279271168387 -0.35982291037333152817 -0.013746484853270015195 -0.36951061254749600904 -0.19209993067344000028 -0.14400978434440428466 0.64987367277836005641 0.063464323699567212755;-0.24380163437002025373 0.10286584574983118068 -0.28212044346160147779 0.64953172265681047293 0.076108383418949987487 -0.37913715518794854908 0.11507119859089970371 0.10806445158369798465 -0.31958510903152570481 -0.19980311815390913721 -0.051800586668347504971 -0.069104865911676680024 0.11564558929657454966 0.20219382014034600892 0.39837052484715423928 -0.27692092635349774277 -0.3336864447427449476 -0.56501715288756293454 -0.34037033515597059363 -0.46869916586648796564;-0.92511974854068046437 -0.16934974185333798169 0.15750668785091850865 0.063775365295671321286 -0.51892312752718061653 -0.041738999693903197641 -0.47851009088203000363 0.085551319930255359525 -0.13767145760103310925 0.42595987498047238606 0.095087083537387762089 -0.016682336057589643857 0.48332827311154041849 0.50610718046950320392 0.12552413514018909146 0.23038333491684351295 -0.094647340047624331505 -0.24699274003472204697 -0.055316394921066408541 0.60143731555367929698;0.74082132976300429927 -0.093702659685453701388 -0.50314151705130671921 0.36037422227820248288 0.33749698911173137139 -0.37425824069390972726 -0.0097682689499204063133 0.5281560390367434632 0.228326510773780883 -0.051636090658772823558 0.24639771697462686806 -0.79196065486243671927 -0.72618700568873617573 0.4287075504651460256 0.11591864010215410796 0.070335627606262315914 0.31407195794439085601 -0.61178897061048409522 -0.30541249167885781146 -0.18101661014669623295];

% Layer 3
b3 = [-1.7702785535085876489;1.7047719649716375212;1.5371634418406268097;1.5269449550024067896;0.96537340715031683125;0.75245312203407510587;-0.67197103925096446364;-0.47720638473050375206;0.26345107353490782032;0.086483172380476300289;-0.21779475878449955362;-0.16693301598745871606;0.62173786868609925982;-0.92020797692671640888;0.98704430136122256467;1.0802585418554178087;-1.2509340202784720031;1.424080772141723239;-1.8271890428052850464;1.7497112257517319911];
LW3_2 = [0.037558730063756227968 -0.94341902413133438277 -0.81448512427418773285 0.88150207143463266135 0.62341069711762686634 0.51809867425998767931 -0.73173458068233199203 -0.50939163241713392161 -0.45349677238961605408 0.013268945726194997237;-0.78950527925797020501 -0.44546349484950176212 0.70977317738236489486 1.0697092457095971341 0.70644987637382195 0.60980185568366684912 -1.1928449631735196235 -0.116743738711165293 -0.11017303730557417851 -0.64800801734685609112;-0.51853132529029644093 -0.68356386231079813154 0.88262600771164911873 -0.82901990389364343947 -0.43913116349457781418 0.354106461360479019 0.61219941038482406093 -0.64207587592948922595 0.39458640019048385472 -0.033840651667921911594;-0.4833859892682719761 -0.34946949464892379522 0.36267577964455077755 -0.24535840662373631371 -0.5169274699401261719 -0.20986329176940260455 -0.81499239518329735787 0.68491245064687233945 0.21468062233471971179 -1.0539648634929805748;-0.80425971776314408856 1.1163117187264746111 -0.5482561442617710501 1.1310921988341822164 -0.086976900893218314637 0.46957139756278920562 0.943885856980220872 -0.33214619881199392015 0.60544571409019853903 -0.72079413601405861733;0.015164063026378264351 0.43055955427939601732 0.83262358127696078913 -0.42746433070462364068 0.95607540550634462218 -0.24950118039922680735 0.57835540480479430414 -0.8771971045379438614 0.11204989978199961231 0.50291777733832720987;0.10093173432809766921 0.7776220627207838243 0.73774069350217197361 -0.71979102217379986595 -0.20705763614119285232 0.81439992643089664792 -0.080813091012720675299 0.8327071023771857039 0.65844965871494698373 0.026932235787119836873;1.0213949465238361114 0.56235860113600122379 -0.93350431108513076683 -0.29407163031182498303 0.054224541614376557674 0.10747691458269911791 -0.25056006532579572221 -0.70233890582160785065 0.015030552551025363334 0.47318163394659817911;-0.70089035286202938657 -0.67170641848960876974 0.73986902628207507071 -0.47983406718273757807 -0.093231457445937637729 -0.58734243050607604086 -0.51390563093140950723 -0.9540785335349832863 0.73209479531253074391 0.55716230773008701416;-0.8060444609323497156 0.82940440368724333009 0.41933288197974644129 0.15536475612339889496 -0.4557459419000318146 0.2344972375154618649 0.49686195652391557109 -0.60436593227576707044 0.75482420038598174727 0.56671384865137208742;-0.47028019091045497602 0.96007457611827795585 -1.2570300361150335 -0.18912028656561546969 0.59960290770623125844 -0.30655047425786241533 -0.035774806101985467954 -0.39509005817860942678 0.19653785155525224648 -0.33871561836488167652;-1.0791824449622786641 -1.1123755695987505021 -0.013182849722994320618 0.3105194835562616329 0.63989728204628593122 0.41846348539737199257 1.1895028961959499547 0.044752490587845118741 0.045685119953008453131 -0.69232066089900590189;-0.12479047123656812623 -1.3743554108915212453 0.4851178461204622705 -0.042705235803926884508 -0.13088565962033049672 -0.25448297663373781186 0.33241807289001079617 -0.62587197430294039258 0.74746280769423301127 0.22208527097453092947;-0.90954362353883710934 -0.16199288149048840513 -1.269744926248145056 0.55558353110606994996 -0.41854207363949930132 0.82884046482151496615 0.45447083909579538696 0.035837679281404966058 0.71460702821249699745 0.45032042054612680948;0.79077774851877391527 -0.67798803481729696951 0.70184955829153850004 0.76320859866765022872 0.63623320337638900046 0.3797037131315217362 0.21174976549754601085 0.061657447343865676159 -0.25680304363538719592 0.81533637371846667818;0.26406115400145396821 -0.12885714469066797405 -0.75138289338879649115 -0.48142163933492987393 -0.80626532027599617791 0.18242316944144032487 0.29066591461077651015 0.83816238058024805646 1.0901065747971663278 0.22851995872051081293;-0.08394761406336279097 0.59830800924170524091 0.44143528607599352709 -0.12962629135532630076 -0.054815794874436801765 -0.23000100306478296619 1.4392541793521442806 -0.81403108133315726924 0.55698757880522065111 -0.15022821552731616124;0.67681622323473011882 0.39880147223864614858 0.62233585230234478303 0.37011794969662809018 0.26685114437047369185 -0.90221070787271628877 -1.0178608495914585053 -0.37352029433275074632 -0.80726669827844987903 0.21727109445405390353;-0.11614895764241707499 -0.92539964597206025854 -0.1183203198689513902 0.75108993527200196283 -0.71533685195762308773 -0.48876445556300374129 -0.86631286272388874359 -0.12647021187880000404 0.86723237719509915777 -0.55651540762571671817;0.6506003638991462168 -0.3606228737664783357 0.20966356277173117673 0.28347788245440364019 -0.0058999976016928176725 1.1299966767364615361 -0.48542660088276579078 0.95920204562700817075 -0.80538481196600730794 -0.24067903414833852205];

% Layer 4
b4 = -0.15876915093705998294;
LW4_3 = [0.13578093223606663154 0.89079151717559645896 -0.2499179142404342191 0.60133690579848297908 -0.69613578044010870904 0.13079085709834908924 0.037040942495067390172 0.73585458686984905885 0.45470524534875456091 -0.075968430667651479227 0.36787457336673867747 0.54177517051971135764 -0.44035480689654971087 -1.2499377292759208391 -0.13144040759080974357 -0.16624726275645812512 -0.55491107377514625743 -0.24290835166751700847 -0.61433942071842362331 -0.97860252720886875544];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1.25;
y1_step1.xoffset = -0.800000000000002;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
